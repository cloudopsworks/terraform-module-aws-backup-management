<!-- 
  ** DO NOT EDIT THIS FILE
  ** 
  ** This file was automatically generated. 
  ** 1) Make all changes to `README.yaml` 
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file. 
  -->
[![README Header][readme_header_img]][readme_header_link]

[![cloudopsworks][logo]](https://cloudops.works/)

# Terraform AWS Backup Management Module




Terraform module to create and manage AWS Backup resources at scale: backup vaults (including logically air-gapped
vaults), backup plans and selections, advanced backup options per resource type, AWS Backup Region Settings, and
optional cross-account sharing via AWS RAM. It helps standardize backup strategies, enforce encryption with KMS,
and streamline operations across environments and accounts.


---

This project is part of our comprehensive approach towards DevOps Acceleration. 
[<img align="right" title="Share via Email" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/ios-mail.svg"/>][share_email]
[<img align="right" title="Share on Google+" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-googleplus.svg" />][share_googleplus]
[<img align="right" title="Share on Facebook" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-facebook.svg" />][share_facebook]
[<img align="right" title="Share on Reddit" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-reddit.svg" />][share_reddit]
[<img align="right" title="Share on LinkedIn" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-linkedin.svg" />][share_linkedin]
[<img align="right" title="Share on Twitter" width="24" height="24" src="https://docs.cloudops.works/images/ionicons/logo-twitter.svg" />][share_twitter]


[![Terraform Open Source Modules](https://docs.cloudops.works/images/terraform-open-source-modules.svg)][terraform_modules]



It's 100% Open Source and licensed under the [APACHE2](LICENSE).







We have [*lots of terraform modules*][terraform_modules] that are Open Source and we are trying to get them well-maintained!. Check them out!






## Introduction

This module provisions and manages AWS Backup across your AWS accounts and regions.
It supports:
• Backup vault creation with optional KMS encryption and logically air-gapped mode.
• Backup plans, rules, lifecycles, and cross-region copy actions.
• Backup selections by tags, ARNs, and conditional expressions.
• Advanced backup options (e.g., Windows VSS) and region settings opt-ins.
• Optional vault sharing via AWS RAM for multi-account strategies.

## Usage


**IMPORTANT:** The `master` branch is used in `source` just as an example. In your code, do not pin to `master` because there may be breaking changes between releases.
Instead pin to the release tag (e.g. `?ref=vX.Y.Z`) of one of our [latest releases](https://github.com/terraform-module-aws-backup-management/releases).


1. Ensure Terragrunt is installed and AWS credentials are configured.
2. In your live repo, create a `terragrunt.hcl` pointing to this module and declare inputs.
3. Copy the input structure below and tailor to your environment. Comments explain each field and defaults.

```hcl
# terragrunt.hcl
terraform {
  source = "git::git@github.com:cloudopsworks/terraform-module-aws-backup-management.git?ref=v1.0.0"
}

inputs = {
  # Core topology
  is_hub   = false                 # (Optional) Is this a hub (true) or spoke (false) deployment? Default: false
  spoke_def = "001"               # (Optional) Three-digit spoke identifier as string. Default: "001"
  org = {                          # (Required) Organization details used for naming and tagging
    organization_name = "acme"    # (Required) Your organization slug
    organization_unit = "plat"    # (Required) Business unit or team
    environment_type  = "prod"    # (Required) One of: prod|stage|dev|test|sandbox (free-form allowed)
    environment_name  = "primary" # (Required) Environment name or alias
  }
  extra_tags = {                   # (Optional) Additional resource tags. Default: {}
    Owner = "backup-team"
  }

  # Backup vault (standard or air-gapped)
  vault = {
    create                = true                 # (Optional) Create the vault with this module. Default: true
    name                  = ""                   # (Optional) Explicit name; required if name_prefix is empty
    name_prefix           = "acme-prod"         # (Optional) Used when name is empty; final: <prefix>-<system>-vault
    encryption_create_key = false                # (Optional) Create a new KMS key for this vault. Default: false
    encryption_key        = ""                   # (Optional) Existing KMS Key ARN when not creating a key
    encryption_alias      = "alias/backup-kms"  # (Optional) Existing KMS Alias when key ARN not provided
    force_destroy         = false                # (Optional) Allow delete even with recovery points. Default: false
  }

  air_gapped = {                  # (Optional) Logically Air-Gapped vault settings
    enabled            = false    # (Optional) Create LAG vault instead of standard. Default: false
    min_retention_days = 0        # (Optional) Minimum retention in days
    max_retention_days = 0        # (Optional) Maximum retention in days
  }

  # Region settings
  region_settings = {             # (Optional) Manage AWS Backup region settings
    enabled = false               # (Optional) Apply settings in this region. Default: false
    opt_ins = {                   # (Optional) Resource opt-ins: ENABLED|DISABLED
      LAMBDA = "ENABLED"
    }
    management_preference = {     # (Optional) SYSTEM|USER per resource type
      EBS = "SYSTEM"
    }
  }

  # Optional cross-account sharing of the vault via RAM
  ram = {
    enabled  = false              # (Optional) Enable AWS RAM share of the vault. Default: false
    accounts = [                  # (Optional) Account IDs to share with
      "111122223333"
    ]
  }

  # Backup plans (rules, selections, advanced options)
  backup_plans = {
    primary = {
      # Optional: custom role when vault.create=false, else module-managed role is used
      # role_arn = "arn:aws:iam::111122223333:role/BackupServiceRole"

      rules = {
        daily = {
          schedule           = "cron(0 12 * * ? *)"  # (Optional) CRON or rate expression
          timezone           = "UTC"                 # (Optional) IANA timezone
          continuous_backup  = true                  # (Optional) Default: false
          start_window       = 60                    # (Optional) Minutes
          completion_window  = 180                   # (Optional) Minutes
          recovery_point_tags = {                    # (Optional) Tags on recovery points
            Purpose = "daily"
          }
          lifecycle = {                              # (Optional)
            cold_storage_after = 30
            delete_after       = 365
            opt_in             = true               # Maps to opt_in_to_archive_for_supported_resources
          }
          copy_action = {                            # (Optional)
            destination_vault_arn = "arn:aws:backup:us-west-2:111122223333:backup-vault:dr"
            lifecycle = {
              cold_storage_after = 30
              delete_after       = 365
              opt_in             = true
            }
          }
        }
      }

      advanced = {                                  # (Optional) Advanced backup settings
        resource_type  = "EC2"                      # e.g., EC2, EBS, RDS, DDB, EFS, FSx, EKS
        backup_options = {
          WindowsVSS = "enabled"                    # Example for Windows/EC2
        }
      }

      resources = {                                  # (Optional) Selection definitions
        by_tag = {
          tags = [
            { type = "STRINGEQUALS", key = "backup", value = "true" }
          ]
        }
        explicit = {
          include_arns = [
            "arn:aws:ec2:us-east-1:111122223333:volume/vol-abc"
          ]
          exclude_arns = []
          conditions = [
            { string_equals = { key = "aws:ResourceTag/Env", value = "prod" } },
            { string_like   = { key = "aws:ResourceTag/App", value = "*api*" } }
          ]
        }
      }
    }
  }

  # Optional: define legal holds (if used by your governance framework)
  legal_holds = {
    # case123 = {
    #   description   = "Litigation hold for case 123"
    #   resource_arns = ["arn:aws:ec2:...:volume/vol-123"]
    #   tags          = { Case = "123" }
    # }
  }
}
```

4. Run `terragrunt init` to initialize the module.
5. Execute `terragrunt plan` and `terragrunt apply` to deploy AWS Backup.

## Quick Start

1. Install Terragrunt and configure AWS credentials (e.g., via AWS SSO or environment variables).
2. Create `terragrunt.hcl` using the Usage section as a template.
3. Run `terragrunt init` to download the module.
4. Run `terragrunt plan` to review changes; then `terragrunt apply` to provision resources.
5. Verify the created AWS Backup vault(s), plan(s), and selection(s) in the AWS Console.


## Examples

## Minimal Terragrunt Example

```hcl
terraform {
  source = "git::git@github.com:cloudopsworks/terraform-module-aws-backup-management.git?ref=v1.0.0"
}

inputs = {
  org = { organization_name = "acme", organization_unit = "plat", environment_type = "dev", environment_name = "blue" }

  vault = { create = true, name_prefix = "acme-dev" }

  backup_plans = {
    default = {
      rules = {
        daily = {
          schedule          = "cron(0 2 * * ? *)"
          timezone          = "UTC"
          continuous_backup = true
        }
      }
    }
  }
}
```

- Creates a vault and a basic daily plan with point-in-time recovery.

## Advanced Terragrunt Example (Air-Gapped + Copy)

```hcl
terraform {
  source = "git::git@github.com:cloudopsworks/terraform-module-aws-backup-management.git?ref=v1.0.0"
}

inputs = {
  is_hub = true
  org = { organization_name = "acme", organization_unit = "sec", environment_type = "prod", environment_name = "primary" }

  region_settings = {
    enabled = true
    opt_ins = { LAMBDA = "ENABLED", EBS = "ENABLED" }
  }

  vault = {
    create                = true
    name_prefix           = "acme-prod"
    encryption_create_key = true
  }

  air_gapped = { enabled = true, min_retention_days = 30, max_retention_days = 3650 }

  backup_plans = {
    critical = {
      rules = {
        monthly = {
          schedule          = "cron(0 0 1 * ? *)"
          timezone          = "UTC"
          lifecycle = { cold_storage_after = 30, delete_after = 365 }
          copy_action = {
            destination_vault_arn = "arn:aws:backup:us-west-2:111122223333:backup-vault:dr"
            lifecycle = { cold_storage_after = 60, delete_after = 730 }
          }
        }
      }
      advanced = {
        resource_type  = "EC2"
        backup_options = { WindowsVSS = "enabled" }
      }
      resources = {
        tag_sel = { tags = [{ type = "STRINGEQUALS", key = "backup", value = "true" }] }
      }
    }
  }
}
```

- Enables region settings, creates an air-gapped vault with KMS, and configures monthly backups with cross-region copy.



## Makefile Targets
```
Available targets:

  help                                Help screen
  help/all                            Display help for all targets
  help/short                          This help short screen
  init/aws                            Initialize the project for a specific cloud provider: AWS
  init/azurerm                        Initialize the project for a specific cloud provider: Azure RM
  init/gcp                            Initialize the project for a specific cloud provider: GCP
  lint                                Lint terraform/opentofu code
  tag                                 Tag the current version

```
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | ~> 6.4 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 6.24.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_tags"></a> [tags](#module\_tags) | cloudopsworks/tags/local | 1.0.9 |

## Resources

| Name | Type |
|------|------|
| [aws_backup_logically_air_gapped_vault.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/backup_logically_air_gapped_vault) | resource |
| [aws_backup_plan.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/backup_plan) | resource |
| [aws_backup_region_settings.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/backup_region_settings) | resource |
| [aws_backup_selection.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/backup_selection) | resource |
| [aws_backup_vault.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/backup_vault) | resource |
| [aws_iam_role.backup_service_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role_policy_attachment.backup_service_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource |
| [aws_kms_alias.create](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_alias) | resource |
| [aws_kms_key.create](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key) | resource |
| [aws_iam_policy_document.backup_service_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_kms_alias.key](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/kms_alias) | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_air_gapped"></a> [air\_gapped](#input\_air\_gapped) | (optional) Air gapped vault configuration | <pre>object({<br/>    enabled            = optional(bool, false)  # (Optional) Enable logically air-gapped vault. Default: false<br/>    min_retention_days = optional(number, 0)    # (Optional) Minimum retention in days. Default: 0<br/>    max_retention_days = optional(number, 0)    # (Optional) Maximum retention in days. Default: 0<br/>  })</pre> | <pre>{<br/>  "max_retention_days": 0,<br/>  "min_retention_days": 0<br/>}</pre> | no |
| <a name="input_backup_plans"></a> [backup\_plans](#input\_backup\_plans) | (optional) List of backup plans to create. If not set, no backup plans will be created | `any` | `{}` | no |
| <a name="input_extra_tags"></a> [extra\_tags](#input\_extra\_tags) | Extra tags to add to the resources | `map(string)` | `{}` | no |
| <a name="input_is_hub"></a> [is\_hub](#input\_is\_hub) | Is this a hub or spoke configuration? | `bool` | `false` | no |
| <a name="input_legal_holds"></a> [legal\_holds](#input\_legal\_holds) | (optional) List of legal holds to create. If not set, no legal holds will be created | `any` | `{}` | no |
| <a name="input_org"></a> [org](#input\_org) | Organization details | <pre>object({<br/>    organization_name = string<br/>    organization_unit = string<br/>    environment_type  = string<br/>    environment_name  = string<br/>  })</pre> | n/a | yes |
| <a name="input_ram"></a> [ram](#input\_ram) | (optional) If true, the backup vault will be shared with other AWS accounts. | <pre>object({<br/>    enabled  = optional(bool, false)        # (Optional) Enable RAM sharing. Default: false<br/>    accounts = optional(list(string), [])   # (Optional) AWS Account IDs to share with when enabled. Default: []<br/>  })</pre> | <pre>{<br/>  "accounts": [],<br/>  "enabled": false<br/>}</pre> | no |
| <a name="input_region_settings"></a> [region\_settings](#input\_region\_settings) | (optional) AWS Backup Region Settings configuration | <pre>object({<br/>    enabled               = optional(bool, false)        # (Optional) Enable region settings management. Default: false<br/>    opt_ins               = optional(map(string), {})    # (Optional) Resource opt-in map. Values: ENABLED|DISABLED. Default: {}<br/>    management_preference = optional(map(string), {})    # (Optional) Management preference map. Values: SYSTEM|USER. Default: {}<br/>  })</pre> | n/a | yes |
| <a name="input_spoke_def"></a> [spoke\_def](#input\_spoke\_def) | Spoke ID Number, must be a 3 digit number | `string` | `"001"` | no |
| <a name="input_vault"></a> [vault](#input\_vault) | (optional) Vault Configuration | <pre>object({<br/>    create                = optional(bool, true)   # (Optional) Create the backup vault with this module. Default: true<br/>    name                  = optional(string, "")  # (Optional) Vault name. Required if name_prefix is not set. Mutually exclusive with name_prefix<br/>    name_prefix           = optional(string, "")  # (Optional) Vault name prefix. Required if name is not set. Mutually exclusive with name<br/>    encryption_create_key = optional(bool, false)  # (Optional) Create a new KMS key and alias for encryption. Default: false<br/>    encryption_key        = optional(string, "")  # (Optional) KMS Key ARN to use for encryption. Used when encryption_create_key=false<br/>    encryption_alias      = optional(string, "")  # (Optional) KMS Alias name (format: alias/<name>) to use if encryption_key not set and encryption_create_key=false<br/>    force_destroy         = optional(bool, false)  # (Optional) Force destroy the vault even if it contains backups. Default: false<br/>  })</pre> | <pre>{<br/>  "air_gapped": false,<br/>  "create": false,<br/>  "encryption_alias": "",<br/>  "encryption_key": "",<br/>  "force_destroy": false,<br/>  "name": "",<br/>  "name_prefix": ""<br/>}</pre> | no |

## Outputs

No outputs.



## Help

**Got a question?** We got answers. 

File a GitHub [issue](https://github.com/terraform-module-aws-backup-management/issues), send us an [email][email] or join our [Slack Community][slack].

[![README Commercial Support][readme_commercial_support_img]][readme_commercial_support_link]

## DevOps Tools

## Slack Community


## Newsletter

## Office Hours

## Contributing

### Bug Reports & Feature Requests

Please use the [issue tracker](https://github.com/terraform-module-aws-backup-management/issues) to report any bugs or file feature requests.

### Developing




## Copyrights

Copyright © 2024-2025 [Cloud Ops Works LLC](https://cloudops.works)





## License 

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0) 

See [LICENSE](LICENSE) for full details.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.









## Trademarks

All other trademarks referenced herein are the property of their respective owners.

## About

This project is maintained by [Cloud Ops Works LLC][website]. 


### Contributors

|  [![Cristian Beraha][berahac_avatar]][berahac_homepage]<br/>[Cristian Beraha][berahac_homepage] |
|---|

  [berahac_homepage]: https://github.com/berahac
  [berahac_avatar]: https://github.com/berahac.png?size=50

[![README Footer][readme_footer_img]][readme_footer_link]
[![Beacon][beacon]][website]

  [logo]: https://cloudops.works/logo-300x69.svg
  [docs]: https://cowk.io/docs?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=docs
  [website]: https://cowk.io/homepage?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=website
  [github]: https://cowk.io/github?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=github
  [jobs]: https://cowk.io/jobs?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=jobs
  [hire]: https://cowk.io/hire?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=hire
  [slack]: https://cowk.io/slack?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=slack
  [linkedin]: https://cowk.io/linkedin?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=linkedin
  [twitter]: https://cowk.io/twitter?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=twitter
  [testimonial]: https://cowk.io/leave-testimonial?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=testimonial
  [office_hours]: https://cloudops.works/office-hours?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=office_hours
  [newsletter]: https://cowk.io/newsletter?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=newsletter
  [email]: https://cowk.io/email?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=email
  [commercial_support]: https://cowk.io/commercial-support?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=commercial_support
  [we_love_open_source]: https://cowk.io/we-love-open-source?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=we_love_open_source
  [terraform_modules]: https://cowk.io/terraform-modules?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=terraform_modules
  [readme_header_img]: https://cloudops.works/readme/header/img
  [readme_header_link]: https://cloudops.works/readme/header/link?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=readme_header_link
  [readme_footer_img]: https://cloudops.works/readme/footer/img
  [readme_footer_link]: https://cloudops.works/readme/footer/link?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=readme_footer_link
  [readme_commercial_support_img]: https://cloudops.works/readme/commercial-support/img
  [readme_commercial_support_link]: https://cloudops.works/readme/commercial-support/link?utm_source=github&utm_medium=readme&utm_campaign=terraform-module-aws-backup-management&utm_content=readme_commercial_support_link
  [share_twitter]: https://twitter.com/intent/tweet/?text=Terraform+AWS+Backup+Management+Module&url=https://github.com/terraform-module-aws-backup-management
  [share_linkedin]: https://www.linkedin.com/shareArticle?mini=true&title=Terraform+AWS+Backup+Management+Module&url=https://github.com/terraform-module-aws-backup-management
  [share_reddit]: https://reddit.com/submit/?url=https://github.com/terraform-module-aws-backup-management
  [share_facebook]: https://facebook.com/sharer/sharer.php?u=https://github.com/terraform-module-aws-backup-management
  [share_googleplus]: https://plus.google.com/share?url=https://github.com/terraform-module-aws-backup-management
  [share_email]: mailto:?subject=Terraform+AWS+Backup+Management+Module&body=https://github.com/terraform-module-aws-backup-management
  [beacon]: https://ga-beacon.cloudops.works/G-7XWMFVFXZT/terraform-module-aws-backup-management?pixel&cs=github&cm=readme&an=terraform-module-aws-backup-management
